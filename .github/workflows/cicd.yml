name: cicd
on:
  push:
    branches:
      - main
env:
  GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
jobs:
  check_pr_has_deploy_label:
    permissions: read-all
    runs-on: ubuntu-latest
    outputs:
      has_deploy_label: ${{ steps.check_pr_labels.outputs.result }}
    steps:
    # - name: Dump context
    #   uses: crazy-max/ghaction-dump-context@v2

    - name: Check PR labels action step
      id: check_pr_labels
      uses: shioyang/check-pr-labels-on-push-action@v1.0.9
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        labels: '["deploy"]'
      timeout-minutes: 5

    # - name: See result
    #   run: echo "${{ steps.check_pr_labels.outputs.result }}"

  deploy:
    if: needs.check_pr_has_deploy_label.outputs.has_deploy_label == 'true'
    runs-on: ubuntu-latest
    needs: check_pr_has_deploy_label
    steps:
    - run: echo ${{ needs.check_pr_has_deploy_label.outputs.has_deploy_label }}